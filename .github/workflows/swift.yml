# This workflow will build a Swift project
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-swift

name: Swift

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v3
    
    - name: Install jq
      uses: dcarbone/install-jq-action@v1.0.1
            
    - name: Test Voir
      run: |
        cd Support/VoirDemo
        SIMULATORNAME=$(xcrun simctl list -j devices available | jq -r '.devices | to_entries[] | (.key | capture("com\\.apple\\.CoreSimulator\\.SimRuntime\\.iOS-(?<version>.+)")) as {$version} | .value[] | {name: "\(.name),OS=\($version|sub("-"; "."))"} | first(.[])' | head -n 1)
        xcodebuild test -scheme "VoirDemo" -destination "platform=iOS Simulator,name=${SIMULATORNAME}" -skip-testing:VoirTests/VoirControllerTests/testComponentWithoutOutputConformance -skip-testing:VoirTests/VoirControllerTests/testViewModelWithoutInputConformance | xcpretty
